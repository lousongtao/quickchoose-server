{
    "type": "Ext.app.Controller",
    "reference": {
        "name": "items",
        "type": "array"
    },
    "codeClass": null,
    "userConfig": {
        "designer|userClassName": "AccountController"
    },
    "designerId": "cb34e083-4517-496c-97a0-a6eeed0a4f1e",
    "cn": [
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|controlQuery": "#addUpdateAccountForm #btnTest",
                "designer|targetType": "Ext.button.Button",
                "fn": "onSaveAccountTest",
                "implHandler": [
                    "Ext.MessageBox.confirm(\r",
                    "    \"confirm\",\r",
                    "    \"test\",\r",
                    "    function(btnId){\r",
                    "        var win = button.up('form').up('window');\r",
                    "        win.close();\r",
                    "    }\r",
                    ");"
                ],
                "name": "click",
                "scope": "me"
            },
            "designerId": "e0358df9-e5fc-4482-b6f8-05b456513dd1"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|controlQuery": "#loginView #loginBtn",
                "designer|targetType": "Ext.button.Button",
                "fn": "onLoginClick",
                "implHandler": [
                    "var form = button.up('form'),\r",
                    "  values = form.getValues(),\r",
                    "  loginView = this.getLoginView();\r",
                    "\r",
                    "var successCallback = function(resp, ops) {\r",
                    "  var result = Ext.decode(resp.responseText);\r",
                    "\r",
                    "  if (result.result == 'ok') {\r",
                    "    Ext.util.Cookies.set(\"userId\", result.userId);\r",
                    "    Ext.util.Cookies.set(\"sessionId\", result.sessionId);\r",
                    "\r",
                    "    loginView.destroy();\r",
                    "\r",
                    "    Ext.create('digitalmenu.view.MainView');\r",
                    "  } else {\r",
                    "    Ext.Msg.alert(\"登录失败\", result.result);\r",
                    "  }\r",
                    "};\r",
                    "\r",
                    "var failureCallback = function(resp, ops) {\r",
                    "  Ext.Msg.alert(\"登录失败\", resp);\r",
                    "};\r",
                    "\r",
                    "Ext.Ajax.request({\r",
                    "  url: \"login\",\r",
                    "  params: values,\r",
                    "  success: successCallback,\r",
                    "  failure: failureCallback\r",
                    "});\r",
                    ""
                ],
                "name": "click",
                "scope": "me"
            },
            "designerId": "05575436-6c2c-4de6-90f7-f04008e14753"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|controlQuery": "#accountListContainer #btnAdd",
                "designer|targetType": "Ext.button.Button",
                "fn": "onAddAccountClick",
                "implHandler": [
                    "var p = Ext.create('digitalmenu.view.AddUpdateAccountForm',{\r",
                    "    title: 'Add User'\r",
                    "\r",
                    "});\r",
                    "\r",
                    "p.down('#btnSaveForAdd').hidden = false;\r",
                    "p.down('#btnSaveForUpdate').hidden = true;\r",
                    "\r",
                    "var permissionGrid = p.down('#permissionGrid');\r",
                    "permissionGrid.store.load();\r",
                    "\r",
                    "var win = Ext.create('Ext.window.Window',{\r",
                    "\r",
                    "    height: 550,\r",
                    "    width: 460,\r",
                    "\theader: false,\r",
                    "\tmodal: true,\r",
                    "    border: false,\r",
                    "\titems:[\r",
                    "        p\r",
                    "\t]\r",
                    "\r",
                    "});\r",
                    "\r",
                    "win.show();\r",
                    ""
                ],
                "name": "click",
                "scope": "me"
            },
            "designerId": "b711c866-7518-43bb-ad40-40021df129c2"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|controlQuery": "#addUpdateAccountForm #btnSaveForAdd",
                "designer|targetType": "Ext.button.Button",
                "fn": "onSaveAddAccountClick",
                "implHandler": [
                    "var form = button.up('form');\r",
                    "var grid = form.down('#permissionGrid');\r",
                    "var values = form.getValues();\r",
                    "var accountGrid = this.getAccountGrid();\r",
                    "\r",
                    "if (values.username.length < 4){\r",
                    "    Ext.Msg.alert(\"Error\",\"The input user name is too short.\");\r",
                    "    return;\r",
                    "}\r",
                    "if (values.password.length < 4 || values.passwordAgain.length < 4){\r",
                    "    Ext.Msg.alert(\"Error\",\"The input password is too short.\");\r",
                    "    return;\r",
                    "}\r",
                    "\r",
                    "if (values.password != values.passwordAgain){\r",
                    "    Ext.Msg.alert(\"Error\",\"The input password are difference, Please input again\");\r",
                    "    return;\r",
                    "}\r",
                    "\r",
                    "var permission = \"\";\r",
                    "for(var i =0; i< grid.store.getCount(); i++){\r",
                    "    if (grid.store.getAt(i).get('choosed')){\r",
                    "        if (permission.length !== 0)\r",
                    "            permission +=\"/\";\r",
                    "        permission += grid.store.getAt(i).get('id');\r",
                    "    }\r",
                    "}\r",
                    "\r",
                    "if (permission.length === 0){\r",
                    "    Ext.Msg.alert(\"Error\",\"You should select correspond PERMISSION for user.\");\r",
                    "    return;\r",
                    "}\r",
                    "\r",
                    "values.userId = Ext.util.Cookies.get(\"userId\");\r",
                    "values.sessionId = Ext.util.Cookies.get(\"sessionId\");\r",
                    "values.permission = permission;\r",
                    "\r",
                    "var successCallback = function(resp, ops) {\r",
                    "  var result = Ext.decode(resp.responseText);\r",
                    "\r",
                    "  if (result.result == 'ok') {\r",
                    "      Ext.Msg.alert(\"SUCCESS\",\"添加账号成功\");\r",
                    "      accountGrid.store.load();\r",
                    "      var win = button.up('form').up('window');\r",
                    "      win.close();\r",
                    "  } else if (result.result == 'invalid_session') {\r",
                    "    digitalmenu.getApplication().onSessionExpired();\r",
                    "  } else {\r",
                    "    Ext.Msg.alert(\"添加账号失败\", resp.responseText);\r",
                    "  }\r",
                    "};\r",
                    "\r",
                    "var failureCallback = function(resp, ops) {\r",
                    "  Ext.Msg.alert(\"添加账号失败\", resp.responseText);\r",
                    "};\r",
                    "\r",
                    "Ext.Ajax.request({\r",
                    "  url: \"account/add\",\r",
                    "  params: values,\r",
                    "  success: successCallback,\r",
                    "  failure: failureCallback\r",
                    "});\r",
                    ""
                ],
                "name": "click",
                "scope": "me"
            },
            "designerId": "977cd1c8-a2f9-4aab-b10e-59a8f7129bab"
        },
        {
            "type": "controllerref",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "ref": "loginView",
                "selector": "#loginView"
            },
            "designerId": "81d9c02a-0f78-458b-acf9-e03b13a88c76"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|controlQuery": "#addUpdateAccountForm #btnCancel",
                "designer|targetType": "Ext.button.Button",
                "fn": "onCancelAccountClick",
                "implHandler": [
                    "Ext.MessageBox.confirm(\r",
                    "    \"Confirm\",\r",
                    "    \"Will you give up all the data input in this form?\",\r",
                    "    function(btnId){\r",
                    "        if (btnId == 'no')\r",
                    "            return;\r",
                    "        var win = button.up('form').up('window');\r",
                    "        win.close();\r",
                    "    }\r",
                    ");\r",
                    "\r",
                    ""
                ],
                "name": "click",
                "scope": "me"
            },
            "designerId": "0ecc1892-4ad1-4791-afae-02bfc69b531a"
        },
        {
            "type": "controllerref",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "ref": "accountGrid",
                "selector": "#accountListContainer #accountListGrid"
            },
            "designerId": "dfe9cb3a-a5fd-4abd-b0e5-204ba0f9022d"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|controlQuery": "#addUpdateAccountForm #btnSaveForUpdate",
                "designer|targetType": "Ext.button.Button",
                "fn": "onSaveUpdateAccountClick",
                "implHandler": [
                    "var form = button.up('form');\r",
                    "var grid = form.down('#permissionGrid');\r",
                    "var values = form.getValues();\r",
                    "var accountGrid = this.getAccountGrid();\r",
                    "\r",
                    "if (values.username.length < 4){\r",
                    "    Ext.Msg.alert(\"Error\",\"The input user name is too short.\");\r",
                    "    return;\r",
                    "}\r",
                    "\r",
                    "var permission = \"\";\r",
                    "for(var i =0; i< grid.store.getCount(); i++){\r",
                    "    if (grid.store.getAt(i).get('choosed')){\r",
                    "        if (permission.length !== 0)\r",
                    "            permission +=\"/\";\r",
                    "        permission += grid.store.getAt(i).get('id');\r",
                    "    }\r",
                    "}\r",
                    "\r",
                    "if (permission.length === 0){\r",
                    "    Ext.Msg.alert(\"Error\",\"You should select correspond PERMISSION for user.\");\r",
                    "    return;\r",
                    "}\r",
                    "\r",
                    "values.userId = Ext.util.Cookies.get(\"userId\");\r",
                    "values.sessionId = Ext.util.Cookies.get(\"sessionId\");\r",
                    "values.permission = permission;\r",
                    "\r",
                    "var successCallback = function(resp, ops) {\r",
                    "  var result = Ext.decode(resp.responseText);\r",
                    "\r",
                    "  if (result.result == 'ok') {\r",
                    "      Ext.Msg.alert(\"SUCCESS\",\"Update account successfully\");\r",
                    "      accountGrid.store.load();\r",
                    "      var win = button.up('form').up('window');\r",
                    "      win.close();\r",
                    "  } else if (result.result == 'invalid_session') {\r",
                    "    digitalmenu.getApplication().onSessionExpired();\r",
                    "  } else {\r",
                    "    Ext.Msg.alert(\"Failed to update account\", result.result);\r",
                    "  }\r",
                    "};\r",
                    "\r",
                    "var failureCallback = function(resp, ops) {\r",
                    "  Ext.Msg.alert(\"Failed to update account\", resp.responseText);\r",
                    "};\r",
                    "\r",
                    "Ext.Ajax.request({\r",
                    "  url: \"account/modify\",\r",
                    "  params: values,\r",
                    "  success: successCallback,\r",
                    "  failure: failureCallback\r",
                    "});"
                ],
                "name": "click",
                "scope": "me"
            },
            "designerId": "84f4ac13-abfd-45a2-b4ca-f3ca03673358"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|controlQuery": "#formChangeUserPassord #btnSave",
                "designer|targetType": "Ext.button.Button",
                "fn": "onChangeUserPassword",
                "implHandler": [
                    "var form = button.up('form');\r",
                    "\r",
                    "var values = form.getValues();\r",
                    "if (values.oldPassword.length === 0){\r",
                    "    Ext.Msg.alert(\"Error\",\"Please input old password\");\r",
                    "    return;\r",
                    "}\r",
                    "if (values.newPassword != values.reNewPassword){\r",
                    "    Ext.Msg.alert(\"Error\",\"new password are different in the 2 boxes\");\r",
                    "    return;\r",
                    "}\r",
                    "var successCallback = function(form, action) {\r",
                    "  var result = action.result;\r",
                    "\r",
                    "  if(action.result.result =='ok'){\r",
                    "      Ext.Msg.alert(\"SUCCESS\",\"Change password successfully.\");\r",
                    "      var win = button.up('form').up('window');\r",
                    "      win.close();\r",
                    "  } else if (action.result.result =='invalid_session'){\r",
                    "      digitalmenu.getApplication().onSessionExpired();\r",
                    "  } else {\r",
                    "      Ext.Msg.alert('Failed',\"Failed to change password.\", action.result.result);\r",
                    "  }\r",
                    "};\r",
                    "\r",
                    "var failureCallback = function(form, action) {\r",
                    "  Ext.Msg.alert(\"Failed to change password\", action.result.result);\r",
                    "};\r",
                    "\r",
                    "\r",
                    "form.submit({\r",
                    "    url: \"account/change_password\",\r",
                    "    params: {\r",
                    "        userId : Ext.util.Cookies.get(\"userId\"),\r",
                    "        sessionId : Ext.util.Cookies.get(\"sessionId\")\r",
                    "    },\r",
                    "    success: successCallback,\r",
                    "    failure: failureCallback\r",
                    "});"
                ],
                "name": "click",
                "scope": "me"
            },
            "designerId": "85f63b7f-6ac2-4638-8910-8504f0de0707"
        },
        {
            "type": "controllerref",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "ref": "changeUserPasswordForm",
                "selector": "#formChangeUserPassord"
            },
            "designerId": "b0f81e91-6721-4ab7-8b31-6e8dbd0a6c14"
        }
    ]
}