{
    "type": "Ext.app.Controller",
    "reference": {
        "name": "items",
        "type": "array"
    },
    "codeClass": null,
    "userConfig": {
        "designer|userClassName": "MenuController"
    },
    "designerId": "d52ffdf7-fa57-4c8c-b328-492bf8857734",
    "cn": [
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|controlQuery": "#menuContainer #btnAdd",
                "designer|targetType": "Ext.button.Button",
                "fn": "onAddMenuItemAction",
                "implHandler": [
                    "//show buttons\r",
                    "this.showSaveCancelButtons(true);\r",
                    "this.getTabCategory1().down('#btnSaveOldCategory1').hide();\r",
                    "this.getTabCategory2().down('#btnSaveOldCategory2').hide();\r",
                    "this.getTabDish().down('#btnSaveOldDish').hide();\r",
                    "//hide image component in dish tab\r",
                    "this.getTabDish().down('#dishPicture').show();\r",
                    "this.getTabDish().down('#image').show();\r",
                    "\r",
                    "//clean data\r",
                    "this.cleanComponentValue();\r",
                    "\r",
                    "this.getTabDish().down('#dishPicture').show();\r",
                    "\r",
                    "//重置一级目录和二级目录的下拉框store并重新生成picker, 即下拉列表\r",
                    "//this.setStoreForCategory1ComboBox();\r",
                    "//this.getTabCategory2().down('#cbCategory1ID').createPicker();\r",
                    "//this.setStoreForCategory2ComboBox();\r",
                    "//this.getTabDish().down('#cbCategory2ID').createPicker();"
                ],
                "name": "click",
                "scope": "me"
            },
            "designerId": "f0d1daf2-f431-477e-82ca-5d161ec84e0a"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|controlQuery": "#menuContainer #btnModify",
                "designer|targetType": "Ext.button.Button",
                "fn": "onModifyMenuItemAction",
                "implHandler": [
                    "var sm = this.getTreeMenu().getSelectionModel();\r",
                    "if (sm.getSelection() === null || sm.getSelection().length === 0){\r",
                    "    return;\r",
                    "}\r",
                    "\r",
                    "var record = sm.getSelection()[0];\r",
                    "\r",
                    "//show save button\r",
                    "this.showSaveCancelButtons(true);\r",
                    "this.getTabCategory1().down('#btnSaveNewCategory1').hide();\r",
                    "this.getTabCategory2().down('#btnSaveNewCategory2').hide();\r",
                    "this.getTabDish().down('#btnSaveNewDish').hide();\r",
                    "\r",
                    "this.getTabDish().down('#dishPicture').hide();\r",
                    "\r",
                    "//重置一级目录和二级目录的下拉框store并重新生成picker, 即下拉列表\r",
                    "//this.setStoreForCategory1ComboBox();\r",
                    "//this.getTabCategory2().down('#cbCategory1ID').createPicker();\r",
                    "//this.setStoreForCategory2ComboBox();\r",
                    "//this.getTabDish().down('#cbCategory2ID').createPicker();\r",
                    "\r",
                    "//把当前选择节点的信息写入控件中\r",
                    "this.showNodeInfoInForm(record);"
                ],
                "name": "click",
                "scope": "me"
            },
            "designerId": "d241d316-f0a1-4b0c-b123-2ce7eef1f540"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|controlQuery": "#menuContainer #btnDelete",
                "designer|targetType": "Ext.button.Button",
                "fn": "onDeleteMenuItemAction",
                "implHandler": [
                    "var sm = this.getTreeMenu().getSelectionModel();\r",
                    "if (sm.getSelection() === null || sm.getSelection().length ===0){\r",
                    "    return;\r",
                    "}\r",
                    "\r",
                    "var record = sm.getSelection()[0];\r",
                    "\r",
                    "if (record.hasChildNodes()){\r",
                    "    Ext.MessageBox.alert(\"Error\", \"Cannot delete this category for having dish still.\");\r",
                    "    return;\r",
                    "}\r",
                    "\r",
                    "var tree = this.getTreeMenu();\r",
                    "var menuContainer = this.getMenuContainer();\r",
                    "\r",
                    "var values = {\r",
                    "    userId : Ext.util.Cookies.get('userId'),\r",
                    "    sessionId : Ext.util.Cookies.get('sessionId'),\r",
                    "    objectId : record.get('objectid'),\r",
                    "    objectType : record.get('level')\r",
                    "};\r",
                    "\r",
                    "var successCallback = function(resp, opts){\r",
                    "    var result = Ext.decode(resp.responseText);\r",
                    "    if (result.result == 'ok') {\r",
                    "        Ext.Msg.alert(\"Successful\", 'Delete ' + record.get('chineseName') + ' successfully.');\r",
                    "        //tree.store.reload();\r",
                    "        record.parentNode.removeChild(record);\r",
                    "        //refresh combobox store\r",
                    "        if (record.get('level') == 'C1'){\r",
                    "          menuContainer.down('#cbCategory1ID').store.load();\r",
                    "        }\r",
                    "        if (record.get('level') == 'C2'){\r",
                    "            menuContainer.down('#cbCategory2ID').store.load();\r",
                    "        }\r",
                    "\r",
                    "    } else if (result.result == 'invalid_session') {\r",
                    "      digitalmenu.getApplication().onSessionExpired();\r",
                    "    } else {\r",
                    "      Ext.Msg.alert(\"Failed\", result.result);\r",
                    "    }\r",
                    "};\r",
                    "\r",
                    "var failureCallback = function(resp, opts){\r",
                    "    Ext.Msg.alert(\"Failed\", resp);\r",
                    "};\r",
                    "\r",
                    "Ext.MessageBox.confirm(\"Confirm\", \"Do you want to delete \" + record.get('chineseName')+\"?\",\r",
                    "    function(btnId){\r",
                    "        if (btnId == 'no')\r",
                    "            return;\r",
                    "        Ext.Ajax.request({\r",
                    "            url: \"menu/delete\",\r",
                    "            params: values,\r",
                    "            success: successCallback,\r",
                    "            failure: failureCallback\r",
                    "        });\r",
                    "});\r",
                    "\r",
                    ""
                ],
                "name": "click",
                "scope": "me"
            },
            "designerId": "474b162a-4eef-4456-9578-72b81f92ad34"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|controlQuery": "#menuContainer #btnSaveNewCategory1",
                "designer|targetType": "Ext.button.Button",
                "fn": "onSaveNewCategory1Click",
                "implHandler": [
                    "var namecn = this.getTabCategory1().down('#tfCategory1CN').getValue();\r",
                    "var nameen = this.getTabCategory1().down('#tfCategory1EN').getValue();\r",
                    "var seq = this.getTabCategory1().down('#nfCategory1Seq').getValue();\r",
                    "var tree = this.getTreeMenu();\r",
                    "\r",
                    "var values = {\r",
                    "    userId : Ext.util.Cookies.get(\"userId\"),\r",
                    "    sessionId : Ext.util.Cookies.get(\"sessionId\"),\r",
                    "    chineseName : namecn,\r",
                    "    englishName : nameen,\r",
                    "    sequence : seq\r",
                    "};\r",
                    "\r",
                    "//把保存成功的节点插入树中\r",
                    "var addNewNode = function(newid){\r",
                    "    //根据sequence找到大于等于新节点的node, 作为插入位置\r",
                    "    var insertposition = tree.getRootNode().childNodes.length;//default value using the biggest one\r",
                    "    for(var i = 0; i < tree.getRootNode().childNodes.length; i++){\r",
                    "        if (tree.getRootNode().getChildAt(i).get('sequence') >= seq){\r",
                    "            insertposition = i;\r",
                    "            break;\r",
                    "        }\r",
                    "    }\r",
                    "\r",
                    "    tree.getRootNode().insertChild(insertposition, {\r",
                    "        objectid : newid,\r",
                    "        level : 'C1',\r",
                    "        //iconCls : 'menutreenode-icon-size',\r",
                    "        //icon : '../dishimage_small/catalog1.png',\r",
                    "        chineseName : namecn,\r",
                    "        englishName : nameen,\r",
                    "        sequence : seq,\r",
                    "        loaded : true,\r",
                    "        expanded : true\r",
                    "    });\r",
                    "};\r",
                    "var me =this;\r",
                    "var menuContainer = this.getMenuContainer();\r",
                    "\r",
                    "Ext.Ajax.request({\r",
                    "    url: \"menu/add_category1\",\r",
                    "    params : values,\r",
                    "    success: function(resp){\r",
                    "        var result = Ext.decode(resp.responseText);\r",
                    "\r",
                    "        if(result.result =='ok'){\r",
                    "            Ext.Msg.alert(\"SUCCESS\", \"Create category1 successfully.\");\r",
                    "            //insert new node\r",
                    "            addNewNode(result.infoMap.id);\r",
                    "            //hide SAVE button and CANCEL button\r",
                    "            me.showSaveCancelButtons(false);\r",
                    "            //refresh combobox store\r",
                    "            menuContainer.down('#cbCategory1ID').store.load();\r",
                    "\r",
                    "        } else if (result.result =='invalid_session'){\r",
                    "            digitalmenu.getApplication().onSessionExpired();\r",
                    "        } else {\r",
                    "            Ext.Msg.alert('Failed',\"Failed to create Category1.\", resp.responseText);\r",
                    "        }\r",
                    "    },\r",
                    "    failure: function(resp){\r",
                    "        Ext.Msg.alert('Failed',\"Failed to create Category1.\", resp.responseText);\r",
                    "    }\r",
                    "});"
                ],
                "name": "click",
                "scope": "me"
            },
            "designerId": "c5670b81-349e-4676-ad12-b65ea7ca2794"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|controlQuery": "#menuContainer #btnSaveOldCategory1",
                "designer|targetType": "Ext.button.Button",
                "fn": "onSaveOldCategory1Click",
                "implHandler": [
                    "var namecn = this.getTabCategory1().down('#tfCategory1CN').getValue();\r",
                    "var nameen = this.getTabCategory1().down('#tfCategory1EN').getValue();\r",
                    "var seq = this.getTabCategory1().down('#nfCategory1Seq').getValue();\r",
                    "var id = this.getTabCategory1().down('#nfID').getValue();\r",
                    "var tree = this.getTreeMenu();\r",
                    "\r",
                    "var values = {\r",
                    "    userId : Ext.util.Cookies.get(\"userId\"),\r",
                    "    sessionId : Ext.util.Cookies.get(\"sessionId\"),\r",
                    "    chineseName : namecn,\r",
                    "    englishName : nameen,\r",
                    "    id : id,\r",
                    "    sequence : seq\r",
                    "};\r",
                    "\r",
                    "//保存成功后重置node属性\r",
                    "var revalueNode = function(){\r",
                    "    var node = tree.getRootNode().findChild('objectid', id);\r",
                    "\r",
                    "    if(seq != node.sequence){\r",
                    "        tree.getRootNode().removeChild(node);\r",
                    "        //根据sequence找到大于等于seq的node, 作为插入位置\r",
                    "        var insertposition = tree.getRootNode().childNodes.length;//default value using the biggest one\r",
                    "        for(var i = 0; i < tree.getRootNode().childNodes.length; i++){\r",
                    "            if (tree.getRootNode().getChildAt(i).get('sequence') >= seq){\r",
                    "                insertposition = i;\r",
                    "                break;\r",
                    "            }\r",
                    "        }\r",
                    "        tree.getRootNode().insertChild(insertposition, node);\r",
                    "    }\r",
                    "    node.set('chineseName', namecn);\r",
                    "    node.set('englishName', nameen);\r",
                    "    node.set('sequence',seq);\r",
                    "};\r",
                    "\r",
                    "var me =this;\r",
                    "Ext.Ajax.request({\r",
                    "    url: \"menu/update_category1\",\r",
                    "    params : values,\r",
                    "    success: function(resp){\r",
                    "        var result = Ext.decode(resp.responseText);\r",
                    "\r",
                    "        if(result.result =='ok'){\r",
                    "            Ext.Msg.alert(\"SUCCESS\",\"Update category1 successfully.\");\r",
                    "            //refresh node value\r",
                    "            revalueNode();\r",
                    "            //hide SAVE button and CANCEL button\r",
                    "            me.showSaveCancelButtons(false);\r",
                    "        } else if (result.result =='invalid_session'){\r",
                    "            digitalmenu.getApplication().onSessionExpired();\r",
                    "        } else {\r",
                    "            Ext.Msg.alert('Failed',\"Failed to update Category1.\", resp.responseText);\r",
                    "        }\r",
                    "    },\r",
                    "    failure: function(resp){\r",
                    "        Ext.Msg.alert('Failed',\"Failed to update Category1.\", resp.responseText);\r",
                    "    }\r",
                    "});"
                ],
                "name": "click",
                "scope": "me"
            },
            "designerId": "358c0943-e58d-4810-ac41-73e5f02d8af3"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|controlQuery": "#menuContainer #btnSaveNewCategory2",
                "designer|targetType": "Ext.button.Button",
                "fn": "onSaveNewCategory2Click",
                "implHandler": [
                    "var namecn = this.getTabCategory2().down('#tfCategory2CN').getValue();\r",
                    "var nameen = this.getTabCategory2().down('#tfCategory2EN').getValue();\r",
                    "var seq = this.getTabCategory2().down('#nfCategory2Seq').getValue();\r",
                    "var category1ID = this.getTabCategory2().down('#cbCategory1ID').getValue();\r",
                    "var printerId = this.getTabCategory2().down('#cbPrinter').getValue();\r",
                    "var tree = this.getTreeMenu();\r",
                    "\r",
                    "if (category1ID < 0){\r",
                    "    Ext.Msg.alert(\"Error\", \"Must select one Category1\");\r",
                    "    return;\r",
                    "}\r",
                    "\r",
                    "var values = {\r",
                    "    userId : Ext.util.Cookies.get(\"userId\"),\r",
                    "    sessionId : Ext.util.Cookies.get(\"sessionId\"),\r",
                    "    chineseName : namecn,\r",
                    "    englishName : nameen,\r",
                    "    printerId : printerId,\r",
                    "    sequence : seq,\r",
                    "    category1Id : category1ID\r",
                    "};\r",
                    "\r",
                    "//把保存成功的节点插入树中\r",
                    "var addNewNode = function(newid){\r",
                    "    //find category1 node, 由于objectid在不同的表中有相同记录的,所以要设置deep=false, 不查找子节点,\r",
                    "    var parentNode = tree.getRootNode().findChild('objectid', category1ID, false);\r",
                    "    //根据sequence找到大于等于新节点的node, 作为插入位置\r",
                    "    var insertposition = parentNode.childNodes.length;//default value using the biggest one\r",
                    "    for(var i = 0; i < parentNode.childNodes.length; i++){\r",
                    "        if (parentNode.getChildAt(i).get('sequence') >= seq){\r",
                    "            insertposition = i;\r",
                    "            break;\r",
                    "        }\r",
                    "    }\r",
                    "\r",
                    "    parentNode.insertChild(insertposition, {\r",
                    "        objectid : newid,\r",
                    "        chineseName : namecn,\r",
                    "        englishName : nameen,\r",
                    "        parentID : category1ID,\r",
                    "        sequence : seq,\r",
                    "        level: 'C2',\r",
                    "        //iconCls : 'menutreenode-icon-size',\r",
                    "        //icon : '../dishimage_small/catalog2.png',\r",
                    "        loaded : true,\r",
                    "        expanded : true\r",
                    "    });\r",
                    "};\r",
                    "\r",
                    "var me =this;\r",
                    "var menuContainer = this.getMenuContainer();\r",
                    "\r",
                    "Ext.Ajax.request({\r",
                    "    url: \"menu/add_category2\",\r",
                    "    params : values,\r",
                    "    success: function(resp){\r",
                    "        var result = Ext.decode(resp.responseText);\r",
                    "\r",
                    "        if(result.result =='ok'){\r",
                    "            Ext.Msg.alert(\"SUCCESS\",\"Create category2 successfully.\");\r",
                    "            //insert new node\r",
                    "            addNewNode(result.infoMap.id);\r",
                    "            //hide SAVE button and CANCEL button\r",
                    "            me.showSaveCancelButtons(false);\r",
                    "            //refresh combobox store\r",
                    "            menuContainer.down('#cbCategory2ID').store.load();\r",
                    "        } else if (result.result =='invalid_session'){\r",
                    "            digitalmenu.getApplication().onSessionExpired();\r",
                    "        } else {\r",
                    "            Ext.Msg.alert('Failed',\"Failed to create Category2.\", resp.responseText);\r",
                    "        }\r",
                    "    },\r",
                    "    failure: function(resp){\r",
                    "        Ext.Msg.alert('Failed',\"Failed to create Category2.\", resp.responseText);\r",
                    "    }\r",
                    "});"
                ],
                "name": "click",
                "scope": "me"
            },
            "designerId": "2adcf784-8679-4bf1-91ee-50cb3e7a184a"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|controlQuery": "#menuContainer #tabCategory2 #btnSaveOldCategory2",
                "designer|targetType": "Ext.button.Button",
                "fn": "onSaveOldCategory2Click",
                "implHandler": [
                    "var namecn = this.getTabCategory2().down('#tfCategory2CN').getValue();\r",
                    "var nameen = this.getTabCategory2().down('#tfCategory2EN').getValue();\r",
                    "var seq = this.getTabCategory2().down('#nfCategory2Seq').getValue();\r",
                    "var id = this.getTabCategory2().down('#nfID').getValue();\r",
                    "var printerId = this.getTabCategory2().down('#cbPrinter').getValue();\r",
                    "var category1ID = this.getTabCategory2().down('#cbCategory1ID').getValue();\r",
                    "var tree = this.getTreeMenu();\r",
                    "\r",
                    "if (category1ID < 0){\r",
                    "    Ext.Msg.alert(\"Error\", \"Must select one Category1\");\r",
                    "    return;\r",
                    "}\r",
                    "\r",
                    "var values = {\r",
                    "    userId : Ext.util.Cookies.get(\"userId\"),\r",
                    "    sessionId : Ext.util.Cookies.get(\"sessionId\"),\r",
                    "    chineseName : namecn,\r",
                    "    englishName : nameen,\r",
                    "    sequence : seq,\r",
                    "    printerId : printerId,\r",
                    "    id : id,\r",
                    "    category1Id : category1ID\r",
                    "};\r",
                    "\r",
                    "//保存成功后重置node属性\r",
                    "var revalueNode = function(){\r",
                    "\r",
                    "    //根据ID找到当前Node以及修改前的parentNode\r",
                    "    var node = tree.getRootNode().findChildBy(function(treenode){\r",
                    "        if (treenode.get('objectid') == id && treenode.get('level') == 'C2')\r",
                    "            return true;\r",
                    "    }, null, true);\r",
                    "    if (node === null){\r",
                    "        Ext.Msg.alert('Failed', 'Data update successfully, but cannot refresh the tree now, please refresh this webpage.');\r",
                    "        return;\r",
                    "    }\r",
                    "    var oldParent = tree.getRootNode().findChild('objectid', node.get('parentID'));\r",
                    "    //var node = oldParent.findChild('objectid',id);\r",
                    "\r",
                    "    //比较seq和contegory1ID是不是有变化, 两者有一个变化则把该Node从原来parentNode下删除,\r",
                    "    //并根据修改后的category1ID(可能就是原来的category1ID)找到新的父节点,\r",
                    "    //再依据sequence插入对应的位置\r",
                    "    if ((node.get('parentID') != category1ID) || (node.get('sequence') != seq)){\r",
                    "        oldParent.removeChild(node);\r",
                    "        var newParent = tree.getRootNode().findChild('objectid',category1ID);\r",
                    "        //根据sequence找到大于等于seq的node, 作为插入位置\r",
                    "        var insertposition = newParent.childNodes.length;//default value using the biggest one\r",
                    "        for(var i = 0; i < newParent.childNodes.length; i++){\r",
                    "            if (newParent.getChildAt(i).get('sequence') >= seq){\r",
                    "                insertposition = i;\r",
                    "                break;\r",
                    "            }\r",
                    "        }\r",
                    "        newParent.insertChild(insertposition, node);\r",
                    "    }\r",
                    "\r",
                    "    //设定名称\r",
                    "    node.set('chineseName', namecn);\r",
                    "    node.set('englishName', nameen);\r",
                    "    node.set('sequence',seq);\r",
                    "    node.set('parentID', category1ID);\r",
                    "};\r",
                    "\r",
                    "var me =this;\r",
                    "Ext.Ajax.request({\r",
                    "    url: \"menu/update_category2\",\r",
                    "    params : values,\r",
                    "    success: function(resp){\r",
                    "        var result = Ext.decode(resp.responseText);\r",
                    "\r",
                    "        if(result.result =='ok'){\r",
                    "            Ext.Msg.alert(\"SUCCESS\",\"Update category2 successfully.\");\r",
                    "            //refresh tree\r",
                    "            revalueNode();\r",
                    "            //hide SAVE button and CANCEL button\r",
                    "            me.showSaveCancelButtons(false);\r",
                    "        } else if (result.result =='invalid_session'){\r",
                    "            digitalmenu.getApplication().onSessionExpired();\r",
                    "        } else {\r",
                    "            Ext.Msg.alert('Failed',\"Failed to update Category2.\", resp.responseText);\r",
                    "        }\r",
                    "    },\r",
                    "    failure: function(resp){\r",
                    "        Ext.Msg.alert('Failed',\"Failed to update Category2.\", resp.responseText);\r",
                    "    }\r",
                    "});"
                ],
                "name": "click",
                "scope": "me"
            },
            "designerId": "89a61a7e-1b13-4c23-8769-650e72d1c253"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|controlQuery": "#menuContainer #btnSaveNewDish",
                "designer|targetType": "Ext.button.Button",
                "fn": "onSaveNewDishClick",
                "implHandler": [
                    "var namecn = this.getTabDish().down('#tfDishCN').getValue();\r",
                    "var nameen = this.getTabDish().down('#tfDishEN').getValue();\r",
                    "var seq = this.getTabDish().down('#nfDishSeq').getValue();\r",
                    "var price = this.getTabDish().down('#nfPrice').getValue();\r",
                    "var isSpecial = this.getTabDish().down('#cbSpecial').getValue();\r",
                    "var isNew = this.getTabDish().down('#cbNew').getValue();\r",
                    "var hotLevel = this.getTabDish().down('#cbHotLevel').getValue();\r",
                    "var category2ID = this.getTabDish().down('#cbCategory2ID').getValue();\r",
                    "//var fileName = this.getTabDish().down('#dishPicture').getValue();\r",
                    "var tree = this.getTreeMenu();\r",
                    "\r",
                    "if (category2ID < 0){\r",
                    "    Ext.Msg.alert(\"Error\", \"Must select one Category2\");\r",
                    "    return;\r",
                    "}\r",
                    "\r",
                    "\r",
                    "var values = {\r",
                    "    userId : Ext.util.Cookies.get(\"userId\"),\r",
                    "    sessionId : Ext.util.Cookies.get(\"sessionId\")\r",
                    "    //chineseName : namecn,\r",
                    "    //englishName : nameen,\r",
                    "    //sequence : seq,\r",
                    "    //price: price,\r",
                    "    //category2Id : category2ID,\r",
                    "    //image : image\r",
                    "};\r",
                    "\r",
                    "//把保存成功的节点插入树中\r",
                    "var addNewNode = function(newid, dishicon){\r",
                    "    //find category1 node\r",
                    "    var parentNode = tree.getRootNode().findChildBy(function(treenode){\r",
                    "        if (treenode.get('objectid') == category2ID && treenode.get('level') == 'C2'){\r",
                    "            return true;\r",
                    "        }\r",
                    "    }, null, true);\r",
                    "\r",
                    "    //根据sequence找到大于等于新节点的node, 作为插入位置\r",
                    "    var insertposition = parentNode.childNodes.length;//default value using the biggest one\r",
                    "    for(var i = 0; i < parentNode.childNodes.length; i++){\r",
                    "        if (parentNode.getChildAt(i).get('sequence') >= seq){\r",
                    "            insertposition = i;\r",
                    "            break;\r",
                    "        }\r",
                    "    }\r",
                    "\r",
                    "    var displayTxt = namecn + (isSpecial? \"<html><font color=red>[SPECIAL]</font></html>\" : \"\") + (isNew? \"<html><font color=red>[NEW]</font></html>\" : \"\");\r",
                    "    parentNode.insertChild(insertposition, {\r",
                    "        objectid : newid,\r",
                    "        level : 'DISH',\r",
                    "        //iconCls : 'menutreenode-icon-size',\r",
                    "        //icon : dishicon,\r",
                    "        pictureName : dishicon,\r",
                    "        displayText : displayTxt,\r",
                    "        chineseName : namecn,\r",
                    "        englishName : nameen,\r",
                    "        parentID : category2ID,\r",
                    "        sequence : seq,\r",
                    "        price : price,\r",
                    "        isNew : isNew,\r",
                    "        isSpecial : isSpecial,\r",
                    "        hotLevel : hotLevel,\r",
                    "        leaf : true\r",
                    "    });\r",
                    "};\r",
                    "\r",
                    "var me =this;\r",
                    "//这里需要上传图片文件,只能使用form.submit方法\r",
                    "button.up('form').submit({\r",
                    "    url: \"menu/add_dish\",\r",
                    "    params : values,\r",
                    "    success: function(form, action){\r",
                    "        var result = action.result;\r",
                    "\r",
                    "        if(action.result.result =='ok'){\r",
                    "            Ext.Msg.alert(\"SUCCESS\",\"Create dish successfully.\");\r",
                    "            //insert new node\r",
                    "            addNewNode(result.infoMap.id, result.infoMap.dishicon);\r",
                    "            //hide SAVE button and CANCEL button\r",
                    "            me.showSaveCancelButtons(false);\r",
                    "        } else if (action.result.result =='invalid_session'){\r",
                    "            digitalmenu.getApplication().onSessionExpired();\r",
                    "        } else {\r",
                    "            Ext.Msg.alert('Failed',\"Failed to create dish.\", action.result.result);\r",
                    "        }\r",
                    "    },\r",
                    "    failure: function(form, action){\r",
                    "        Ext.Msg.alert('Failed',\"Failed to create dish.\", action.result.result);\r",
                    "    }\r",
                    "});"
                ],
                "name": "click",
                "scope": "me"
            },
            "designerId": "4141b3ba-8526-4913-92e2-45e2840582f5"
        },
        {
            "type": "controllerref",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "ref": "menuContainer",
                "selector": "#menuContainer"
            },
            "designerId": "17285ea2-fa09-4ba7-b698-390aaf28c72b"
        },
        {
            "type": "controllerref",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "ref": "tabCategory1",
                "selector": "#menuContainer #tabCategory1"
            },
            "designerId": "885bf59f-02c5-4b8c-8aa8-226e9efbb253"
        },
        {
            "type": "controllerref",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "ref": "tabCategory2",
                "selector": "#menuContainer #tabCategory2"
            },
            "designerId": "700dace9-595c-4b9a-9197-fe48fa25e076"
        },
        {
            "type": "controllerref",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "ref": "tabDish",
                "selector": "#menuContainer #tabDish"
            },
            "designerId": "a003a551-4e23-4cf8-9c18-651ac7d6fb3f"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|controlQuery": "#menuContainer #btnSaveOldDish",
                "designer|targetType": "Ext.button.Button",
                "fn": "onSaveOldDishClick",
                "implHandler": [
                    "var namecn = this.getTabDish().down('#tfDishCN').getValue();\r",
                    "var nameen = this.getTabDish().down('#tfDishEN').getValue();\r",
                    "var seq = this.getTabDish().down('#nfDishSeq').getValue();\r",
                    "var id = this.getTabDish().down('#nfID').getValue();\r",
                    "var price = this.getTabDish().down('#nfPrice').getValue();\r",
                    "var isSpecial = this.getTabDish().down('#cbSpecial').getValue();\r",
                    "var isNew = this.getTabDish().down('#cbNew').getValue();\r",
                    "var hotLevel = this.getTabDish().down('#cbHotLevel').getValue();\r",
                    "var category2ID = this.getTabDish().down('#cbCategory2ID').getValue();\r",
                    "var tree = this.getTreeMenu();\r",
                    "\r",
                    "if (category2ID < 0){\r",
                    "    Ext.Msg.alert(\"Error\", \"Must select one Category2\");\r",
                    "    return;\r",
                    "}\r",
                    "\r",
                    "var values = {\r",
                    "    userId : Ext.util.Cookies.get(\"userId\"),\r",
                    "    sessionId : Ext.util.Cookies.get(\"sessionId\"),\r",
                    "    chineseName : namecn,\r",
                    "    englishName : nameen,\r",
                    "    sequence : seq,\r",
                    "    price: price,\r",
                    "    id : id,\r",
                    "    isNew : isNew,\r",
                    "    isSpecial : isSpecial,\r",
                    "    hotLevel : hotLevel,\r",
                    "    category2Id : category2ID,\r",
                    "    pictureName : \"\"\r",
                    "};\r",
                    "\r",
                    "//保存成功后重置node属性\r",
                    "var revalueNode = function(){\r",
                    "\r",
                    "    //根据ID找到当前Node以及修改前的parentNode\r",
                    "    var node = tree.getRootNode().findChildBy(function(treenode){\r",
                    "        if (treenode.get('objectid') == id && treenode.get('level') == 'DISH'){\r",
                    "            return true;\r",
                    "        }\r",
                    "    }, null, true);\r",
                    "    var oldParent = tree.getRootNode().findChildBy(function(treenode){\r",
                    "        if (treenode.get('objectid') == node.get('parentID') && treenode.get('level') == 'C2'){\r",
                    "            return true;\r",
                    "        }\r",
                    "    }, null, true);\r",
                    "\r",
                    "\r",
                    "    //比较seq和contegory2ID是不是有变化, 两者有一个变化则把该Node从原来parentNode下删除,\r",
                    "    //并根据修改后的category2ID(可能就是原来的category2ID)找到新的父节点,\r",
                    "    //再依据sequence插入对应的位置\r",
                    "    if ((node.get('parentID') != category2ID) || (node.get('sequence') != seq)){\r",
                    "        oldParent.removeChild(node);\r",
                    "        var newParent = tree.getRootNode().findChildBy(function(tn){\r",
                    "            if (tn.get('objectid') == category2ID && tn.get('level') == 'C2'){\r",
                    "                return true;\r",
                    "            }\r",
                    "        }, null, true);\r",
                    "\r",
                    "        //根据sequence找到大于等于seq的node, 作为插入位置\r",
                    "        var insertposition = newParent.childNodes.length;//default value using the biggest one\r",
                    "        for(var i = 0; i < newParent.childNodes.length; i++){\r",
                    "            if (newParent.getChildAt(i).get('sequence') >= seq){\r",
                    "                insertposition = i;\r",
                    "                break;\r",
                    "            }\r",
                    "        }\r",
                    "        newParent.insertChild(insertposition, node);\r",
                    "    }\r",
                    "\r",
                    "    var displayTxt = namecn + (isSpecial? \"<html><font color=red>[SPECIAL]</font></html>\" : \"\") + (isNew? \"<html><font color=red>[NEW]</font></html>\" : \"\");\r",
                    "\r",
                    "    //设定值\r",
                    "    node.set('displayText', displayTxt);\r",
                    "    node.set('chineseName', namecn);\r",
                    "    node.set('englishName', nameen);\r",
                    "    node.set('sequence',seq);\r",
                    "    node.set('price',price);\r",
                    "    node.set('isNew', isNew);\r",
                    "    node.set('isSpecial', isSpecial);\r",
                    "    node.set('hotLevel', hotLevel);\r",
                    "    node.set('parentID', category2ID);\r",
                    "    //node.pictureName =\r",
                    "};\r",
                    "\r",
                    "var me =this;\r",
                    "Ext.Ajax.request({\r",
                    "    url: \"menu/update_dish\",\r",
                    "    params : values,\r",
                    "    success: function(resp){\r",
                    "        var result = Ext.decode(resp.responseText);\r",
                    "\r",
                    "        if(result.result =='ok'){\r",
                    "            Ext.Msg.alert(\"SUCCESS\",\"Update dish successfully.\");\r",
                    "            //refresh tree\r",
                    "            revalueNode();\r",
                    "            //hide SAVE button and CANCEL button\r",
                    "            me.showSaveCancelButtons(false);\r",
                    "        } else if (result.result =='invalid_session'){\r",
                    "            digitalmenu.getApplication().onSessionExpired();\r",
                    "        } else {\r",
                    "            Ext.Msg.alert('Failed',\"Failed to update dish.\", resp.responseText);\r",
                    "        }\r",
                    "    },\r",
                    "    failure: function(resp){\r",
                    "        Ext.Msg.alert('Failed',\"Failed to update dish.\", resp.responseText);\r",
                    "    }\r",
                    "});"
                ],
                "name": "click",
                "scope": "me"
            },
            "designerId": "e66dea68-0199-44cb-8d00-3acd33ae4623"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|controlQuery": "#menuContainer #treeMenu",
                "designer|targetType": "Ext.tree.Panel",
                "fn": "onMenuTreeItemClick",
                "implHandler": [
                    "//重置store并重新生成picker, 即下拉列表\r",
                    "//this.setStoreForCategory1ComboBox();\r",
                    "//this.getTabCategory2().down('#cbCategory1ID').createPicker();\r",
                    "//this.setStoreForCategory2ComboBox();\r",
                    "//this.getTabDish().down('#cbCategory2ID').createPicker();\r",
                    "//set value\r",
                    "this.showNodeInfoInForm(record);"
                ],
                "name": "itemclick",
                "scope": "me"
            },
            "designerId": "149eb37b-97a7-4480-bdb9-c35de51a2b11"
        },
        {
            "type": "controllerref",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "ref": "treeMenu",
                "selector": "#menuContainer #treeMenu"
            },
            "designerId": "751dc949-07c3-4fcf-b55b-2a816036d4fa"
        },
        {
            "type": "controllerref",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "ref": "cbCategory1",
                "selector": "#menuContainer #tabCategory2 #cbCategory1ID"
            },
            "designerId": "fd0a6a86-ede6-4517-9752-ffaa724faa44"
        },
        {
            "type": "controllerref",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "ref": "cbCategory2",
                "selector": "#menuContainer #tabDish #cbCategory2ID"
            },
            "designerId": "e340bc27-a792-4ae3-badf-069a125a12e1"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|controlQuery": "#menuContainer #tabCategory1 #btnCancel",
                "designer|targetType": "Ext.button.Button",
                "fn": "onCancelCategory1Click",
                "implHandler": [
                    "var me = this;\r",
                    "Ext.MessageBox.confirm(\r",
                    "    \"Confirm\",\r",
                    "    \"Will you give up all the data input in this form?\",\r",
                    "    function(btnId){\r",
                    "        if (btnId == 'no')\r",
                    "            return;\r",
                    "        //hide SAVE button and CANCEL button\r",
                    "        me.showSaveCancelButtons(false);\r",
                    "    }\r",
                    ");\r",
                    "\r",
                    ""
                ],
                "name": "click",
                "scope": "me"
            },
            "designerId": "b2013e98-d844-48e4-9fe1-5822279b2e38"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|controlQuery": "#menuContainer #tabCategory2 #btnCancel",
                "designer|targetType": "Ext.button.Button",
                "fn": "onCancelCategory2Click",
                "implHandler": [
                    "var me = this;\r",
                    "Ext.MessageBox.confirm(\r",
                    "    \"Confirm\",\r",
                    "    \"Will you give up all the data input in this form?\",\r",
                    "    function(btnId){\r",
                    "        if (btnId == 'no')\r",
                    "            return;\r",
                    "        //hide SAVE button and CANCEL button\r",
                    "        me.showSaveCancelButtons(false);\r",
                    "    }\r",
                    ");\r",
                    ""
                ],
                "name": "click",
                "scope": "me"
            },
            "designerId": "d9e2ed67-256e-4d18-8a65-6232ba16444e"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|controlQuery": "#menuContainer #tabDish #btnCancel",
                "designer|targetType": "Ext.button.Button",
                "fn": "onCancelDishClick",
                "implHandler": [
                    "var me = this;\r",
                    "Ext.MessageBox.confirm(\r",
                    "    \"Confirm\",\r",
                    "    \"Will you give up all the data input in this form?\",\r",
                    "    function(btnId){\r",
                    "        if (btnId == 'no')\r",
                    "            return;\r",
                    "        //hide SAVE button and CANCEL button\r",
                    "        me.showSaveCancelButtons(false);\r",
                    "    }\r",
                    ");\r",
                    ""
                ],
                "name": "click",
                "scope": "me"
            },
            "designerId": "c4b37ecb-fced-4008-acf3-17cabe427f65"
        },
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|params": [
                    "isShow"
                ],
                "fn": "showSaveCancelButtons",
                "implHandler": [
                    "if (isShow){\r",
                    "    this.getTabCategory1().down('#btnSaveNewCategory1').show();\r",
                    "    this.getTabCategory2().down('#btnSaveNewCategory2').show();\r",
                    "    this.getTabDish().down('#btnSaveNewDish').show();\r",
                    "\r",
                    "    this.getTabCategory1().down('#btnSaveOldCategory1').show();\r",
                    "    this.getTabCategory2().down('#btnSaveOldCategory2').show();\r",
                    "    this.getTabDish().down('#btnSaveOldDish').show();\r",
                    "\r",
                    "    this.getTabCategory1().down('#btnCancel').show();\r",
                    "    this.getTabCategory2().down('#btnCancel').show();\r",
                    "    this.getTabDish().down('#btnCancel').show();\r",
                    "} else {\r",
                    "    this.getTabCategory1().down('#btnSaveNewCategory1').hide();\r",
                    "    this.getTabCategory2().down('#btnSaveNewCategory2').hide();\r",
                    "    this.getTabDish().down('#btnSaveNewDish').hide();\r",
                    "\r",
                    "    this.getTabCategory1().down('#btnSaveOldCategory1').hide();\r",
                    "    this.getTabCategory2().down('#btnSaveOldCategory2').hide();\r",
                    "    this.getTabDish().down('#btnSaveOldDish').hide();\r",
                    "\r",
                    "    this.getTabCategory1().down('#btnCancel').hide();\r",
                    "    this.getTabCategory2().down('#btnCancel').hide();\r",
                    "    this.getTabDish().down('#btnCancel').hide();\r",
                    "}"
                ]
            },
            "designerId": "f3f3b9fb-8228-4614-b941-d84e0b6e58a5"
        },
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "fn": "cleanComponentValue",
                "implHandler": [
                    "//右侧的三个Tab页面的控件, 全部清空数据\r",
                    "this.getTabCategory1().down('#nfID').setValue(0);\r",
                    "this.getTabCategory1().down('#tfCategory1CN').setValue(\"\");\r",
                    "this.getTabCategory1().down('#tfCategory1EN').setValue(\"\");\r",
                    "this.getTabCategory1().down('#nfCategory1Seq').setValue(\"\");\r",
                    "\r",
                    "this.getTabCategory2().down('#nfID').setValue(0);\r",
                    "this.getTabCategory2().down('#tfCategory2CN').setValue(\"\");\r",
                    "this.getTabCategory2().down('#tfCategory2EN').setValue(\"\");\r",
                    "this.getTabCategory2().down('#nfCategory2Seq').setValue(\"\");\r",
                    "this.getTabCategory2().down('#cbCategory1ID').setValue(\"\");\r",
                    "\r",
                    "this.getTabDish().down('#nfID').setValue(0);\r",
                    "this.getTabDish().down('#tfDishCN').setValue(\"\");\r",
                    "this.getTabDish().down('#tfDishEN').setValue(\"\");\r",
                    "this.getTabDish().down('#nfDishSeq').setValue(\"\");\r",
                    "this.getTabDish().down('#cbCategory2ID').setValue(\"\");\r",
                    "this.getTabDish().down('#nfPrice').setValue(0);\r",
                    "this.getTabDish().down('#image').setSrc(null);\r",
                    "this.getTabDish().down('#cbNew').setValue(false);\r",
                    "this.getTabDish().down('#cbSpecial').setValue(false);\r",
                    "this.getTabDish().down('#cbHotLevel').setValue(0);"
                ]
            },
            "designerId": "3e5a558d-6827-4d89-ab49-d06050d2f9db"
        },
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "fn": "setStoreForCategory1ComboBox",
                "implHandler": [
                    "//遍历tree, 搜集category1的数据存入数组\r",
                    "var listCategory1 = [];\r",
                    "var rootNode = this.getTreeMenu().getRootNode();\r",
                    "if (rootNode !== null){\r",
                    "    var c1Nodes = rootNode.childNodes;\r",
                    "    if (c1Nodes !== null){\r",
                    "        for(var i = 0; i<c1Nodes.length; i++){\r",
                    "            if (c1Nodes[i].get('id').substr(0,2) === 'C1'){\r",
                    "                listCategory1.push([c1Nodes[i].get('id').substr(3,10), c1Nodes[i].get('chineseName')]);\r",
                    "            }\r",
                    "        }\r",
                    "    }\r",
                    "}\r",
                    "\r",
                    "//初始化category1 的下拉列表\r",
                    "var storeCategory1 = Ext.create('Ext.data.ArrayStore', {\r",
                    "    fields: ['id', 'chineseName'],\r",
                    "    data: listCategory1\r",
                    "});\r",
                    "this.getTabCategory2().down('#cbCategory1ID').store = storeCategory1;"
                ]
            },
            "designerId": "eef224c6-e29f-4900-9dff-b04820a80ad1"
        },
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "fn": "setStoreForCategory2ComboBox",
                "implHandler": [
                    "//遍历tree, 搜集category2的数据存入数组\r",
                    "var listCategory2 = [];\r",
                    "var rootNode = this.getTreeMenu().getRootNode();\r",
                    "if (rootNode !== null){\r",
                    "    var c1Nodes = rootNode.childNodes;\r",
                    "    if (c1Nodes !== null){\r",
                    "        for(var i = 0; i<c1Nodes.length; i++){\r",
                    "            if (c1Nodes[i].get('id').substr(0,2) === 'C1'){\r",
                    "                var c2Nodes = c1Nodes[i].childNodes;\r",
                    "                if (c2Nodes !== null){\r",
                    "                    for(var j = 0; j<c2Nodes.length; j++){\r",
                    "                        if (c2Nodes[j].get('id').substr(0,2) === 'C2'){\r",
                    "                            listCategory2.push([c2Nodes[j].get('id').substr(3,10), c2Nodes[j].get('chineseName')]);\r",
                    "                        }\r",
                    "                    }\r",
                    "                }\r",
                    "            }\r",
                    "        }\r",
                    "    }\r",
                    "}\r",
                    "\r",
                    "//初始化category2 的下拉列表\r",
                    "var storeCategory2 = Ext.create('Ext.data.ArrayStore', {\r",
                    "    fields: ['id', 'chineseName'],\r",
                    "    data: listCategory2\r",
                    "});\r",
                    "this.getTabDish().down('#cbCategory2ID').store = storeCategory2;"
                ]
            },
            "designerId": "d2a2035c-9ca6-4120-90f4-5dd68426e833"
        },
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|params": [
                    "record"
                ],
                "fn": "showNodeInfoInForm",
                "implHandler": [
                    "if ('C1' == record.get('level')){\r",
                    "    this.getTabCategory1().up().setActiveTab(this.getTabCategory1());\r",
                    "    this.getTabCategory1().down('#nfID').setValue(record.get('objectid'));\r",
                    "    this.getTabCategory1().down('#tfCategory1CN').setValue(record.get('chineseName'));\r",
                    "    this.getTabCategory1().down('#tfCategory1EN').setValue(record.get('englishName'));\r",
                    "    this.getTabCategory1().down('#nfCategory1Seq').setValue(record.get('sequence'));\r",
                    "} else if ('C2' == record.get('level')){\r",
                    "    this.getTabCategory2().up().setActiveTab(this.getTabCategory2());\r",
                    "    this.getTabCategory2().down('#nfID').setValue(record.get('objectid'));\r",
                    "    this.getTabCategory2().down('#tfCategory2CN').setValue(record.get('chineseName'));\r",
                    "    this.getTabCategory2().down('#tfCategory2EN').setValue(record.get('englishName'));\r",
                    "    this.getTabCategory2().down('#nfCategory2Seq').setValue(record.get('sequence'));\r",
                    "    this.getTabCategory2().down('#cbCategory1ID').setValue(record.get('parentID'));\r",
                    "    this.getTabCategory2().down('#cbPrinter').setValue(record.get('printerId'));\r",
                    "} else if ('DISH' == record.get('level')){\r",
                    "    this.getTabDish().up().setActiveTab(this.getTabDish());\r",
                    "    this.getTabDish().down('#nfID').setValue(record.get('objectid'));\r",
                    "    this.getTabDish().down('#tfDishCN').setValue(record.get('chineseName'));\r",
                    "    this.getTabDish().down('#tfDishEN').setValue(record.get('englishName'));\r",
                    "    this.getTabDish().down('#nfDishSeq').setValue(record.get('sequence'));\r",
                    "    this.getTabDish().down('#nfPrice').setValue(record.get('price'));\r",
                    "    this.getTabDish().down('#cbCategory2ID').setValue(record.get('parentID'));\r",
                    "    this.getTabDish().down('#image').setSrc('../dishimage_original/'+record.get('pictureName'));\r",
                    "    this.getTabDish().down('#cbNew').setValue(record.get('isNew'));\r",
                    "    this.getTabDish().down('#cbSpecial').setValue(record.get('isSpecial'));\r",
                    "    this.getTabDish().down('#cbHotLevel').setValue(record.get('hotLevel'));\r",
                    "}\r",
                    ""
                ]
            },
            "designerId": "8f050626-746a-4fb0-bc66-31cb120e02c5"
        },
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|params": [
                    "node"
                ],
                "fn": "refreshNode",
                "implHandler": [
                    ""
                ]
            },
            "designerId": "2c0590c2-c88d-49a7-abdd-77bdc662e2ca"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|controlQuery": "#menuContainer #tabDish #filePicture",
                "designer|targetType": "Ext.form.field.File",
                "fn": "onFilefieldChange",
                "implHandler": [
                    "console.log('enter already');\r",
                    "filefield.up('panel').down('#image').setSrc(value);"
                ],
                "name": "change",
                "scope": "me"
            },
            "designerId": "3a611ae7-31a3-4b8d-9649-1ee0f89520c0"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|controlQuery": "#formChangeDishPrice #btnSave",
                "designer|targetType": "Ext.button.Button",
                "fn": "onSaveDishPriceClick",
                "implHandler": [
                    "var tree = this.getTreeMenu();\r",
                    "//保存成功后重置node属性\r",
                    "var revalueNode = function(dishid, newPrice){\r",
                    "    //find the dish node by id\r",
                    "    var c1nodes = tree.getRootNode().childNodes;\r",
                    "    breakTag:\r",
                    "    for(var i = 0; i< c1nodes.length; i++){\r",
                    "        var c2nodes = c1nodes[i].childNodes;\r",
                    "        for(var j = 0; j< c2nodes.length; j++){\r",
                    "            var dishnodes = c2nodes[j].childNodes;\r",
                    "            for (var k = 0; k< dishnodes.length; k++){\r",
                    "                if(dishnodes[k].get('objectid') == dishid){\r",
                    "                    dishnodes[k].set('price', newPrice);\r",
                    "                    break breakTag;\r",
                    "                }\r",
                    "            }\r",
                    "        }\r",
                    "    }\r",
                    "};\r",
                    "var dishid = button.up('form').getValues().id;\r",
                    "var price = button.up('form').getValues().newPrice;\r",
                    "var successCallback = function(resp){\r",
                    "    var result = Ext.decode(resp.responseText);\r",
                    "    if(result.result ==='ok'){\r",
                    "        Ext.Msg.alert(\"SUCCESS\",\"Change price successfully.\");\r",
                    "        var win = button.up('form').up('window');\r",
                    "        win.close();\r",
                    "        revalueNode(dishid,price);\r",
                    "    } else if (result.result === 'invalid_session'){\r",
                    "        digitalmenu.getApplication().onSessionExpired();\r",
                    "    } else {\r",
                    "        Ext.Msg.alert('Failed', 'failed to change price, please do again');\r",
                    "    }\r",
                    "};\r",
                    "\r",
                    "var failureCallback = function(resp){\r",
                    "    Ext.Msg.alert('Failed','failed to change price, please do again');\r",
                    "};\r",
                    "Ext.Ajax.request({\r",
                    "    url: 'menu/change_dish_price',\r",
                    "    params: {\r",
                    "        userId : Ext.util.Cookies.get('userId'),\r",
                    "        sessionId : Ext.util.Cookies.get('sessionId'),\r",
                    "        id : dishid,\r",
                    "        newPrice : price\r",
                    "    },\r",
                    "    success : successCallback,\r",
                    "    failure : failureCallback\r",
                    "});"
                ],
                "name": "click",
                "scope": "me"
            },
            "designerId": "ef3090a8-445d-49c9-9d4b-5f4521ab89bb"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|controlQuery": "#formChangeDishPicture #btnSave",
                "designer|targetType": "Ext.button.Button",
                "fn": "onSaveDishPictureClick",
                "implHandler": [
                    "var dishid = button.up('form').getValues().id;\r",
                    "var tree = this.getTreeMenu();\r",
                    "//保存成功后重置node的picture信息, 由于浏览器有缓存, 所以图片保存后, 必须改变一下名字, 让浏览器重新获取图片\r",
                    "var revalueNode = function(dishid, newPicture){\r",
                    "    //find the dish node by id\r",
                    "    var c1nodes = tree.getRootNode().childNodes;\r",
                    "    breakTag:\r",
                    "    for(var i = 0; i< c1nodes.length; i++){\r",
                    "        var c2nodes = c1nodes[i].childNodes;\r",
                    "        for(var j = 0; j< c2nodes.length; j++){\r",
                    "            var dishnodes = c2nodes[j].childNodes;\r",
                    "            for (var k = 0; k< dishnodes.length; k++){\r",
                    "                if(dishnodes[k].get('objectid') == dishid){\r",
                    "                    dishnodes[k].set('pictureName', newPicture);\r",
                    "                    break breakTag;\r",
                    "                }\r",
                    "            }\r",
                    "        }\r",
                    "    }\r",
                    "};\r",
                    "\r",
                    "var failureCallback = function(resp){\r",
                    "    Ext.Msg.alert('Failed','failed to change picture, please do again');\r",
                    "};\r",
                    "\r",
                    "var successCallback = function(form, action){\r",
                    "        if(action.result.result =='ok'){\r",
                    "            Ext.Msg.alert(\"SUCCESS\",\"Change picture successfully.\");\r",
                    "            var win = button.up('form').up('window');\r",
                    "            win.close();\r",
                    "            revalueNode(dishid, action.result.infoMap.dishicon);\r",
                    "        } else if (action.result.result =='invalid_session'){\r",
                    "            digitalmenu.getApplication().onSessionExpired();\r",
                    "        } else {\r",
                    "            Ext.Msg.alert('Failed',\"Failed to change picture.\", action.result.result);\r",
                    "        }\r",
                    "    };\r",
                    "\r",
                    "button.up('form').submit({\r",
                    "    url: 'menu/changedishpicture',\r",
                    "    params: {\r",
                    "        userId : Ext.util.Cookies.get('userId'),\r",
                    "        sessionId : Ext.util.Cookies.get('sessionId')\r",
                    "    },\r",
                    "    success : successCallback,\r",
                    "    failure : failureCallback\r",
                    "});"
                ],
                "name": "click",
                "scope": "me"
            },
            "designerId": "c0c6139d-5c87-4639-a44f-54a4f22c833f"
        }
    ]
}